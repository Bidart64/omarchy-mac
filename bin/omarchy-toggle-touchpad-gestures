#!/bin/bash

# Toggle touchpad gestures in Hyprland
# This script enables/disables touchpad gestures for workspace switching and other actions

INPUT_CONF="$HOME/.config/hypr/input.conf"

# Define gesture lines
WORKSPACE_GESTURE="gesture = 3, horizontal, workspace"
VERTICAL_GESTURE="gesture = 3, vertical, fullscreen"
FOUR_FINGER_GESTURE="gesture = 4, horizontal, workspace"

# Check if the input.conf file exists
if [ ! -f "$INPUT_CONF" ]; then
    echo "Error: Hyprland input.conf file not found at $INPUT_CONF"
    exit 1
fi

# Function to toggle a gesture line
toggle_gesture() {
    local gesture_line="$1"
    local description="$2"
    
    if grep -q "^$gesture_line" "$INPUT_CONF"; then
        # Gesture is enabled, disable it
        sed -i "s/^$gesture_line/# $gesture_line/" "$INPUT_CONF"
        echo "  Disabled: $description"
        return 1
    else
        # Gesture is disabled or doesn't exist, enable it
        if grep -q "^# $gesture_line" "$INPUT_CONF"; then
            # Uncomment existing line
            sed -i "s/^# $gesture_line/$gesture_line/" "$INPUT_CONF"
        else
            # Add gesture line if it doesn't exist
            echo "" >> "$INPUT_CONF"
            echo "# Touchpad gestures" >> "$INPUT_CONF"
            echo "$gesture_line" >> "$INPUT_CONF"
        fi
        echo "  Enabled: $description"
        return 0
    fi
}

# Check current state and toggle
enabled_count=0
total_count=0

echo "Toggling touchpad gestures..."

# Toggle main workspace switching gesture
if toggle_gesture "$WORKSPACE_GESTURE" "3-finger horizontal workspace switching"; then
    ((enabled_count++))
fi
((total_count++))

# Only show notification if notify-send is available
if command -v notify-send >/dev/null 2>&1; then
    if [ $enabled_count -gt 0 ]; then
        notify-send "󰟸  Touchpad Gestures" "Enabled $enabled_count/$total_count gestures"
    else
        notify-send "󰟸  Touchpad Gestures" "Disabled all touchpad gestures"
    fi
fi

# Reload Hyprland configuration to apply changes
if command -v hyprctl >/dev/null 2>&1; then
    hyprctl reload
    echo "Hyprland configuration reloaded"
else
    echo "Note: hyprctl not found. You may need to restart Hyprland to apply changes."
fi